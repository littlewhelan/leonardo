function formatDates(t){return{full:moment(t).format(fullDate),pretty:moment(t).format(prettyDate)}}var app=angular.module("leo",["ngRoute","ngAnimate","ui.bootstrap"]),prettyDate="MM/DD/YYgYY",fullDate="MM/DD/YYYY h:mm:ss a";app.config(["$routeProvider",function(t){t.when("/",{templateUrl:"static/login.html"}).when("/search",{templateUrl:"private/search.html"}).when("/register",{templateUrl:"static/register.html"}).when("/contactList",{templateUrl:"private/contactList.html"}).when("/addfamily",{templateUrl:"private/addfamily.html"}).when("/addcorp",{templateUrl:"private/addcorp.html"}).when("/contactlist",{templateUrl:"private/contactlist.html"}).otherwise({redirectTo:"/search"})}]),app.factory("authInterceptor",["$q","$location","authService",function(t,e,n){return{request:function(t){return t.headers=t.headers||{},n.isAuthed()&&(t.headers.Authorization="Bearer "+n.getToken()),t},response:function(n){return 401===n.status&&e.path("/"),n||t.when(n)},responseError:function(n){return 401===n.status?e.path("/"):console.log(n.status),t.reject(n)}}}]),app.service("authService",["$window",function(t){this.parseJwt=function(e){if(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))}return{}},this.saveToken=function(e){t.localStorage.jwtToken=e},this.getToken=function(){return t.localStorage.jwtToken},this.isAuthed=function(){var t=this.getToken();if(t){var e=this.parseJwt(t),n=Math.round((new Date).getTime()/1e3)<=e.exp;return n||this.logout(),n}return!1},this.logout=function(){delete t.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.controller("editCorpCtrl",["$scope","$uibModal","$log","ResultService","$http",function(t,e,n,o,a){t.companies=o.companies,t.animationsEnabled=!0,t.open=function(o,i){return console.log("corp call",i),a({method:"GET",url:"../corporation",params:{id:i}}).then(function(a){t.company=a.data;var i=e.open({animation:t.animationsEnabled,templateUrl:"private/editcorp.html",controller:"ModalInstanceCtrl",size:o,scope:t,resolve:{items:function(){return t.company}}});i.result.then(function(e){t.selected=e},function(){n.info("Modal dismissed at: "+new Date)})})},t.toggleAnimation=function(){t.animationsEnabled=!t.animationsEnabled}}]),app.controller("createListSearch",["$scope","$rootScope","ContactListDataService",function(t,e,n){e.add=!1,t.listForm={},t.searchListBtn=function(){n.makeDataCall(t.listForm.data),t.listForm={}}}]),app.factory("ContactListDataService",["$http",function(t){var e=[],n=[],o=[],a=[],i=function(n){return t({method:"GET",URL:"/createMailList",params:{search:n}}).then(function(t){e=t.data,r(e),s(e),l(e)})},s=function(t){var e=function(t){a.splice(0,a.length),t.forEach(function(t){"adult"==t.type&&a.push(t)})};return e(t),a},r=function(t){var e=function(t){n.splice(0,n.length),t.forEach(function(t){"company"==t.type&&n.push(t)})};return e(t),n},l=function(t){var e=function(t){o.splice(0,o.length),t.forEach(function(t){"child"==t.type&&kids.push(t)})};return e(t),o},c={makeDataCall:i,getCompanies:r,getKids:l,getAdults:s,results:e,allKids:o,allAdults:a,allCompanies:n};return c}]),app.controller("editFamilyCtrl",["$scope","$uibModal","$log","ResultService","$http",function(t,e,n,o,a){t.adults=o.adults,t.kids=o.kids,t.animationsEnabled=!0,t.open=function(o,i){return console.log("family call",i),a({method:"GET",url:"../family",params:{id:i}}).then(function(a){t.family=a.data;var i=e.open({animation:t.animationsEnabled,templateUrl:"private/editfamily.html",controller:"ModalInstanceCtrl",size:o,scope:t,resolve:{items:function(){return t.family}}});i.result.then(function(e){t.selected=e},function(){n.info("Modal dismissed at: "+new Date)})})},t.toggleAnimation=function(){t.animationsEnabled=!t.animationsEnabled}}]),app.controller("loginCtrl",["$scope","$http","authService","$location","$rootScope",function(t,e,n,o,a){t.submit=function(){e.post("/login",t.form).then(function(t){n.saveToken(t.data),a.user=n.getUser(),o.path("/search")})}}]),app.controller("searchFunction",["$scope","$http","ResultService",function(t,e,n){t.formInput={},t.searchBtn=function(){n.makeDataCall(t.formInput.data),console.log("this is the input text",t.formInput),t.formInput={}}}]),app.factory("ResultService",["$http",function(t){var e=[],n=[],o=[],a=[],i=function(n){return t({method:"GET",url:"../search",params:{search:n}}).then(function(t){e=t.data,s(e),l(e),r(e)})},s=function(t){var e=function(t){o.splice(0,o.length),t.forEach(function(t){"company"==t.type&&o.push(t)})};return e(t),console.log("this is getElement1",o),o},r=function(t){var e=function(t){n.splice(0,n.length),t.forEach(function(t){"adult"==t.type&&n.push(t)})};return e(t),console.log("this is in getElement2",n),n},l=function(t){var e=function(t){a.splice(0,a.length),t.forEach(function(t){"child"==t.type&&a.push(t)})};return e(t),console.log("this is getElements3",a),a},c={getKids:l,getAdults:r,getCompanies:s,makeDataCall:i,results:e,companies:o,adults:n,kids:a};return c}]),app.controller("ModalInstanceCtrl",["$scope","$modalInstance",function(t,e){t.ok=function(){e.close(t.selected.item)},t.cancel=function(){e.dismiss("cancel")}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location",function(t,e,n,o){n.user=t.getUser(),n.user&&n.user.username&&o.path("/home"),e.logout=function(){t.logout(),n.user=t.getUser(),o.path("/")}}]),app.controller("newContactListController",["newContactListData","$scope","$http",function(t,e){e.listname={},e.createList=function(){console.log("create list: "+e.listname.input);var n=t.postList(e.listname.input);n.then(function(t){console.log(t),listNum=toString(t.id),console.log("Id? ",t.id)}),console.log("list #",e.listNum),console.log("list type",typeof e.listNum),e.listname={}}}]),app.service("newContactListData",["ContactListDataService","$http",function(t,e){this.newContactList=[],this.listNum="",this.postList=function(t){return console.log("did the name make it to the service? "+t),e.post("/newContactList",{name:t}).then(function(t){console.log(t),listNum=toString(t.id),console.log("Id? ",t.id)},function(t){console.log(t)})},this.importDataArray=[{email_addresses:["user1@example.com"],first_name:"John",last_name:"Smith",company_name:"Company X",addresses:[{city:"anytown"}]},{email_addresses:["user2@example.com"],first_name:"Jane",last_name:"Smithy",company_name:"Company Y",addresses:[{city:"sometown"}]}],this.popList=function(){n(),e.post("/populateContactList.js",importDataArray,listNum).then(function(t,e,n,o){console.log(t)}),console.log(options)};var n=function(){$(":checked.type-element").each(function(){if(id==t.results.id){var e={email_addresses:[$(this).email],first_name:$(this).firstName,last_name:$(this).lastName,company_name:$(this).company,addresses:[{city:$(this).city}]};importDataArray.push(e)}})}}]),app.controller("popListController",["newContactListData","$scope","$http",function(t,e,n){e.listName={},e.populateList=function(){console.log("create list: "+scope.listName.input),t.popList(),e.listName={}}}]),app.controller("registerCtrl",["$scope","$http","$location",function(t,e,n){t.submit=function(){console.log("registerCtrl"),console.log("registerController submit:",t.form),e.post("/register",t.form).then(function(t){console.log(t),n.path("/index")})}}]),app.controller("resetCtrl",["$scope","$http","$location",function(t,e,n){t.submit=function(){console.log("edit password:",t.form),e.put("/admin",t.form).then(function(t){console.log(t),n.path("/index")})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImF1dGhJbnRlcmNlcHRvci5qcyIsImF1dGhTZXJ2aWNlLmpzIiwiY29ycENvbnRyb2xsZXIuanMiLCJjcmVhdGVMaXN0Q29udG9sbGVyLmpzIiwiY3JlYXRlTGlzdFNlcnZpY2UuanMiLCJmYW1pbHlDb250cm9sbGVyLmpzIiwibG9naW5Db250cm9sbGVyLmpzIiwibWFpblNlYXJjaENvbnRyb2xsZXIuanMiLCJtYWluU2VhcmNoU2VydmljZS5qcyIsIm1vZGFsSW5zdGFuY2VDb250cm9sbGVyLmpzIiwibmF2Q29udHJvbGxlci5qcyIsIm5ld0NvbnRhY3RMaXN0Q29udHJvbGxlci5qcyIsIm5ld0NvbnRhY3RMaXN0U2VydmljZS5qcyIsInBvcExpc3RDb250cm9sbGVyLmpzIiwicmVnaXN0ZXJDb250cm9sbGVyLmpzIiwicmVzZXRDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImZvcm1hdERhdGVzIiwiZGF0ZSIsImZ1bGwiLCJtb21lbnQiLCJmb3JtYXQiLCJmdWxsRGF0ZSIsInByZXR0eSIsInByZXR0eURhdGUiLCJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwiZmFjdG9yeSIsIiRxIiwiJGxvY2F0aW9uIiwiYXV0aFNlcnZpY2UiLCJyZXF1ZXN0IiwiaGVhZGVycyIsImlzQXV0aGVkIiwiQXV0aG9yaXphdGlvbiIsImdldFRva2VuIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJwYXRoIiwicmVzcG9uc2VFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJyZWplY3QiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJwYXJzZUp3dCIsInRva2VuIiwiYmFzZTY0VXJsIiwic3BsaXQiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsInNhdmVUb2tlbiIsImxvY2FsU3RvcmFnZSIsImp3dFRva2VuIiwicGFyYW1zIiwibm90RXhwaXJlZCIsIk1hdGgiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwibG9nb3V0IiwiZ2V0VXNlciIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkdWliTW9kYWwiLCIkbG9nIiwiUmVzdWx0U2VydmljZSIsIiRodHRwIiwiY29tcGFuaWVzIiwiYW5pbWF0aW9uc0VuYWJsZWQiLCJvcGVuIiwic2l6ZSIsImlkIiwibWV0aG9kIiwidXJsIiwidGhlbiIsImNvbXBhbnkiLCJkYXRhIiwibW9kYWxJbnN0YW5jZSIsImFuaW1hdGlvbiIsInNjb3BlIiwicmVzb2x2ZSIsIml0ZW1zIiwicmVzdWx0Iiwic2VsZWN0ZWRJdGVtIiwic2VsZWN0ZWQiLCJpbmZvIiwidG9nZ2xlQW5pbWF0aW9uIiwiJHJvb3RTY29wZSIsIkNvbnRhY3RMaXN0RGF0YVNlcnZpY2UiLCJhZGQiLCJsaXN0Rm9ybSIsInNlYXJjaExpc3RCdG4iLCJtYWtlRGF0YUNhbGwiLCJyZXN1bHRzIiwiYWxsQ29tcGFuaWVzIiwiYWxsS2lkcyIsImFsbEFkdWx0cyIsInBhc3NlZERhdGEiLCJVUkwiLCJzZWFyY2giLCJnZXRDb21wYW5pZXMiLCJnZXRBZHVsdHMiLCJnZXRLaWRzIiwiYXJyYXkiLCJnZXRFbGVtZW50MyIsInNwbGljZSIsImxlbmd0aCIsImZvckVhY2giLCJlbGVtZW50IiwidHlwZSIsInB1c2giLCJraWRzIiwiZGF0YUFwaSIsImFkdWx0cyIsImZhbWlseSIsInN1Ym1pdCIsInBvc3QiLCJmb3JtIiwidXNlciIsImZvcm1JbnB1dCIsInNlYXJjaEJ0biIsImdldEVsZW1lbnQxIiwiZ2V0RWxlbWVudDIiLCJwdWJsaWNBcGkiLCIkbW9kYWxJbnN0YW5jZSIsIm9rIiwiY2xvc2UiLCJpdGVtIiwiY2FuY2VsIiwiZGlzbWlzcyIsInVzZXJuYW1lIiwibmV3Q29udGFjdExpc3REYXRhIiwibGlzdG5hbWUiLCJjcmVhdGVMaXN0IiwiaW5wdXQiLCJwcm9taXNlIiwicG9zdExpc3QiLCJsaXN0TnVtIiwidG9TdHJpbmciLCJuZXdDb250YWN0TGlzdCIsIm5hbWUiLCJpbXBvcnREYXRhQXJyYXkiLCJlbWFpbF9hZGRyZXNzZXMiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwiY29tcGFueV9uYW1lIiwiYWRkcmVzc2VzIiwiY2l0eSIsInBvcExpc3QiLCJnZXRDaGVja2VkIiwib3B0aW9ucyIsIiQiLCJlYWNoIiwiY29udGFjdE9iamVjdCIsImVtYWlsIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJsaXN0TmFtZSIsInBvcHVsYXRlTGlzdCIsInB1dCJdLCJtYXBwaW5ncyI6IkFBS0EsUUFBQUEsYUFBQUMsR0FDQSxPQUNBQyxLQUFBQyxPQUFBRixHQUFBRyxPQUFBQyxVQUNBQyxPQUFBSCxPQUFBRixHQUFBRyxPQUFBRyxhQVJBLEdBQUFDLEtBQUFDLFFBQUFDLE9BQUEsT0FBQSxVQUFBLFlBQUEsaUJBRUFILFdBQUEsY0FDQUYsU0FBQSxzQkFTQUcsS0FBQUcsUUFBQSxpQkFDQSxTQUFBQyxHQUNBQSxFQUNBQyxLQUFBLEtBQ0FDLFlBQUEsc0JBRUFELEtBQUEsV0FDQUMsWUFBQSx3QkFFQUQsS0FBQSxhQUNBQyxZQUFBLHlCQUVBRCxLQUFBLGdCQUNBQyxZQUFBLDZCQUVBRCxLQUFBLGNBQ0FDLFlBQUEsMkJBRUFELEtBQUEsWUFDQUMsWUFBQSx5QkFFQUQsS0FBQSxnQkFDQUMsWUFBQSw2QkFFQUMsV0FDQUMsV0FBQSxlQ3JDQVIsSUFBQVMsUUFBQSxtQkFBQSxLQUFBLFlBQUEsY0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBLE9BQ0FDLFFBQUEsU0FBQVYsR0FLQSxNQUpBQSxHQUFBVyxRQUFBWCxFQUFBVyxZQUNBRixFQUFBRyxhQUNBWixFQUFBVyxRQUFBRSxjQUFBLFVBQUFKLEVBQUFLLFlBRUFkLEdBRUFlLFNBQUEsU0FBQUEsR0FPQSxNQUxBLE9BQUFBLEVBQUFDLFFBR0FSLEVBQUFTLEtBQUEsS0FFQUYsR0FBQVIsRUFBQUwsS0FBQWEsSUFDQUcsY0FBQSxTQUFBSCxHQVNBLE1BUkEs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QVgsYUFBQU0sRUFBQWhILE1BQUFvQyxRQUNBdUUsWUFDQUMsS0FBQUksRUFBQWhILE1BQUE0RyxPQUdBTixpQkFBQS9CLEtBQUEyQyxVQzlFQTdJLElBQUFpRCxXQUFBLHFCQUFBLHFCQUFBLFNBQUEsUUFBQSxTQUFBc0UsRUFBQXJFLEVBQUFJLEdBSUFKLEVBQUErRixZQUVBL0YsRUFBQWdHLGFBQUEsV0FDQTVILFFBQUFDLElBQUEsZ0JBQUE0QyxNQUFBOEUsU0FBQXZCLE9BRUFILEVBQUFpQixVQVlBdEYsRUFBQStGLGdCQ25CQWpKLElBQUFpRCxXQUFBLGdCQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUFDLEVBQUFJLEVBQUEzQyxHQUNBdUMsRUFBQXFELE9BQUEsV0FDQWpGLFFBQUFDLElBQUEsZ0JBQ0FELFFBQUFDLElBQUEsNkJBQUEyQixFQUFBdUQsTUFDQW5ELEVBQUFrRCxLQUFBLFlBQUF0RCxFQUFBdUQsTUFDQTNDLEtBQUEsU0FBQTVDLEdBQ0FJLFFBQUFDLElBQUFMLEdBQ0FQLEVBQUFTLEtBQUEsZ0JDVEFwQixJQUFBaUQsV0FBQSxhQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUFDLEVBQUFJLEVBQUEzQyxHQUNBdUMsRUFBQXFELE9BQUEsV0FDQWpGLFFBQUFDLElBQUEsaUJBQUEyQixFQUFBdUQsTUFDQW5ELEVBQUE2RixJQUFBLFNBQUFqRyxFQUFBdUQsTUFDQTNDLEtBQUEsU0FBQTVDLEdBQ0FJLFFBQUFDLElBQUFMLEdBQ0FQLEVBQUFTLEtBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbGVvJywgWyduZ1JvdXRlJywgJ25nQW5pbWF0ZScsICd1aS5ib290c3RyYXAnXSk7XG5cbnZhciBwcmV0dHlEYXRlID0gXCJNTS9ERC9ZWWdZWVwiO1xudmFyIGZ1bGxEYXRlID0gXCJNTS9ERC9ZWVlZIGg6bW06c3MgYVwiO1xuXG5mdW5jdGlvbiBmb3JtYXREYXRlcyAoZGF0ZSkge1xuXHRyZXR1cm4ge1xuXHRcdGZ1bGw6IG1vbWVudChkYXRlKS5mb3JtYXQoZnVsbERhdGUpLFxuXHRcdHByZXR0eTogbW9tZW50KGRhdGUpLmZvcm1hdChwcmV0dHlEYXRlKVxuXHR9O1xufVxuXG5hcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLFxuICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLlxuICAgICAgICAgICAgd2hlbignLycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3N0YXRpYy9sb2dpbi5odG1sJ1xuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICB3aGVuKCcvc2VhcmNoJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncHJpdmF0ZS9zZWFyY2guaHRtbCdcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgd2hlbignL3JlZ2lzdGVyJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc3RhdGljL3JlZ2lzdGVyLmh0bWwnXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIHdoZW4oJy9jb250YWN0TGlzdCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ByaXZhdGUvY29udGFjdExpc3QuaHRtbCdcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgd2hlbignL2FkZGZhbWlseScsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ByaXZhdGUvYWRkZmFtaWx5Lmh0bWwnXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIHdoZW4oJy9hZGRjb3JwJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncHJpdmF0ZS9hZGRjb3JwLmh0bWwnXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIHdoZW4oJy9jb250YWN0bGlzdCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ByaXZhdGUvY29udGFjdGxpc3QuaHRtbCdcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgb3RoZXJ3aXNlKHtcbiAgICAgICAgICAgICAgICByZWRpcmVjdFRvOiAnL3NlYXJjaCdcbiAgICAgICAgICAgIH0pO1xuICAgIH1dKTtcblxuXG5cblxuIiwiYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xuICAgICAgICB9LCByZXNwb25zZUVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH07XG59XSkiLCJhcHAuc2VydmljZSgnYXV0aFNlcnZpY2UnLCBbJyR3aW5kb3cnLCBmdW5jdGlvbiAoJHdpbmRvdykge1xuXG4gICAgdGhpcy5wYXJzZUp3dCA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBiYXNlNjRVcmwgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xuICAgICAgICAgICAgdmFyIGJhc2U2NCA9IGJhc2U2NFVybC5yZXBsYWNlKCctJywgJysnKS5yZXBsYWNlKCdfJywgJy8nKTtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cuYXRvYihiYXNlNjQpKTtcbiAgICAgICAgfSBlbHNlIHJldHVybiB7fTtcbiAgICB9O1xuXG4gICAgdGhpcy5zYXZlVG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW4gPSB0b2tlbjtcbiAgICAgICAgLy9jb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKSIsIi8vZWRpdCBjb3Jwb3JhdGlvbiBtb2RhbCB0ZW1wbGF0ZVxuYXBwLmNvbnRyb2xsZXIoJ2VkaXRDb3JwQ3RybCcsIFsnJHNjb3BlJywgJyR1aWJNb2RhbCcsICckbG9nJywgJ1Jlc3VsdFNlcnZpY2UnLCAnJGh0dHAnLCBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWwsICRsb2csIFJlc3VsdFNlcnZpY2UsICRodHRwKSB7XG4gICAgLy9zZW5kcyB0aGUgY29tcGFuaWVzIGFmdGVyIHRoZSByZXN1bHRzIGhhdmUgYmVlbiBvcmdhbml6ZWRcbiAgICAgICAgJHNjb3BlLmNvbXBhbmllcyA9IFJlc3VsdFNlcnZpY2UuY29tcGFuaWVzO1xuXG4gICAgJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkID0gdHJ1ZTtcblxuICAgICRzY29wZS5vcGVuID0gZnVuY3Rpb24gKHNpemUsIGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjb3JwIGNhbGwnLCBpZCk7XG4gICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnLi4vY29ycG9yYXRpb24nLFxuICAgICAgICAgICAgcGFyYW1zOntpZDppZH1cbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW55ID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiAkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncHJpdmF0ZS9lZGl0Y29ycC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ01vZGFsSW5zdGFuY2VDdHJsJyxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmNvbXBhbnk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRsb2cuaW5mbygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS50b2dnbGVBbmltYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCA9ICEkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQ7XG4gICAgfTtcblxuXG59XSk7XG4iLCJhcHAuY29udHJvbGxlcignY3JlYXRlTGlzdFNlYXJjaCcsWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICdDb250YWN0TGlzdERhdGFTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCBDb250YWN0TGlzdERhdGFTZXJ2aWNlKXtcbiAgICAkcm9vdFNjb3BlLmFkZCA9IGZhbHNlO1xuICAgICRzY29wZS5saXN0Rm9ybT17fTtcblxuICAgICRzY29wZS5zZWFyY2hMaXN0QnRuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL3Bhc3NlcyBpbiBzZWFyY2ggdGV4dCB0byBzZXJ2aWNlXG4gICAgICAgIENvbnRhY3RMaXN0RGF0YVNlcnZpY2UubWFrZURhdGFDYWxsKCRzY29wZS5saXN0Rm9ybS5kYXRhKTtcbiAgICAgICAgLy9lbXB0eSB0aGUgc2VhcmNoIGJveFxuICAgICAgICAkc2NvcGUubGlzdEZvcm09e307XG4gICAgfTtcbn1dKTsiLCJhcHAuZmFjdG9yeSgnQ29udGFjdExpc3REYXRhU2VydmljZScsWyckaHR0cCcsIGZ1bmN0aW9uKCRodHRwKSB7XG5cbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHZhciBhbGxDb21wYW5pZXMgPSBbXTtcbiAgICB2YXIgYWxsS2lkcyA9IFtdO1xuICAgIHZhciBhbGxBZHVsdHMgPSBbXTtcblxuICAgIHZhciBtYWtlRGF0YUNhbGwgPSBmdW5jdGlvbiAocGFzc2VkRGF0YSkge1xuICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIFVSTDogJy9jcmVhdGVNYWlsTGlzdCcsXG4gICAgICAgICAgICBwYXJhbXM6IHtzZWFyY2g6IHBhc3NlZERhdGF9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXN1bHRzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIGdldENvbXBhbmllcyhyZXN1bHRzKTtcbiAgICAgICAgICAgIGdldEFkdWx0cyhyZXN1bHRzKTtcbiAgICAgICAgICAgIGdldEtpZHMocmVzdWx0cyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cblxuICAgIHZhciBnZXRBZHVsdHMgPSBmdW5jdGlvbiAoYXJyYXkpIHtcbiAgICAgICAgdmFyIGdldEVsZW1lbnQzID0gZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICAgICAgICBhbGxBZHVsdHMuc3BsaWNlKDAsIGFsbEFkdWx0cy5sZW5ndGgpO1xuICAgICAgICAgICAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnR5cGUgPT0gJ2FkdWx0JylcbiAgICAgICAgICAgICAgICAgICAgYWxsQWR1bHRzLnB1c2goZWxlbWVudCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuICAgICAgICBnZXRFbGVtZW50MyhhcnJheSk7XG4gICAgICAgIHJldHVybiBhbGxBZHVsdHNcbiAgICB9O1xuXG4gICAgdmFyIGdldENvbXBhbmllcyA9IGZ1bmN0aW9uIChhcnJheSkge1xuICAgICAgICB2YXIgZ2V0RWxlbWVudDMgPSBmdW5jdGlvbiAoYXJyYXkpIHtcbiAgICAgICAgICAgIGFsbENvbXBhbmllcy5zcGxpY2UoMCwgYWxsQ29tcGFuaWVzLmxlbmd0aCk7XG4gICAgICAgICAgICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PSAnY29tcGFueScpXG4gICAgICAgICAgICAgICAgICAgIGFsbENvbXBhbmllcy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgICAgZ2V0RWxlbWVudDMoYXJyYXkpO1xuICAgICAgICByZXR1cm4gYWxsQ29tcGFuaWVzXG4gICAgfTtcblxuICAgIHZhciBnZXRLaWRzID0gZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICAgIHZhciBnZXRFbGVtZW50MyA9IGZ1bmN0aW9uIChhcnJheSkge1xuICAgICAgICAgICAgYWxsS2lkcy5zcGxpY2UoMCwgYWxsS2lkcy5sZW5ndGgpO1xuICAgICAgICAgICAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnR5cGUgPT0gJ2NoaWxkJylcbiAgICAgICAgICAgICAgICAgICAga2lkcy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgICAgZ2V0RWxlbWVudDMoYXJyYXkpO1xuICAgICAgICByZXR1cm4gYWxsS2lkc1xuICAgIH07XG5cbiAgICB2YXIgZGF0YUFwaSA9IHtcbiAgICAgICAgbWFrZURhdGFDYWxsOiBtYWtlRGF0YUNhbGwsXG4gICAgICAgIGdldENvbXBhbmllczogZ2V0Q29tcGFuaWVzLFxuICAgICAgICBnZXRLaWRzOiBnZXRLaWRzLFxuICAgICAgICBnZXRBZHVsdHM6IGdldEFkdWx0cyxcbiAgICAgICAgcmVzdWx0czogcmVzdWx0cyxcbiAgICAgICAgYWxsS2lkczogYWxsS2lkcyxcbiAgICAgICAgYWxsQWR1bHRzOiBhbGxBZHVsdHMsXG4gICAgICAgIGFsbENvbXBhbmllczogYWxsQ29tcGFuaWVzXG4gICAgfTtcblxuICAgIHJldHVybiBkYXRhQXBpO1xuXG59XSk7XG4iLCIvL2VkaXQgZmFtaWx5IG1vZGFsIHRlbXBsYXRlXG5hcHAuY29udHJvbGxlcignZWRpdEZhbWlseUN0cmwnLFsnJHNjb3BlJywgJyR1aWJNb2RhbCcsICckbG9nJywnUmVzdWx0U2VydmljZScsICckaHR0cCcsIGZ1bmN0aW9uICgkc2NvcGUsICR1aWJNb2RhbCwgJGxvZywgUmVzdWx0U2VydmljZSwgJGh0dHApIHtcblxuICAgIC8vc2VuZHMgdGhlIGFkdWx0cyBhbmQga2lkcyBhZnRlciB0aGUgcmVzdWx0cyBoYXZlIGJlZW4gb3JnYW5pemVkXG4gICAgICAgICRzY29wZS5hZHVsdHMgPSBSZXN1bHRTZXJ2aWNlLmFkdWx0cztcbiAgICAgICAgJHNjb3BlLmtpZHMgPSBSZXN1bHRTZXJ2aWNlLmtpZHM7XG5cbiAgICAkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQgPSB0cnVlO1xuICAgICAgICAkc2NvcGUub3BlbiA9IGZ1bmN0aW9uIChzaXplLCBpZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZhbWlseSBjYWxsJyxpZCk7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnLi4vZmFtaWx5JyxcbiAgICAgICAgICAgICAgICBwYXJhbXM6e2lkOmlkfVxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICBcdFx0XHQkc2NvcGUuZmFtaWx5ID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246ICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncHJpdmF0ZS9lZGl0ZmFtaWx5Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ01vZGFsSW5zdGFuY2VDdHJsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IHNpemUsXG4gICAgICAgICAgICAgIFx0XHRcdFx0c2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZhbWlseTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRsb2cuaW5mbygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZUFuaW1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQgPSAhJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkO1xuICAgICAgICAgICAgfTtcblxuXG59XSk7IiwiLy9jb250cm9sbGVycyBmb3IgbG9naW5cbmFwcC5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsICdhdXRoU2VydmljZScsICckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIGF1dGhTZXJ2aWNlLCAkbG9jYXRpb24sICRyb290U2NvcGUpe1xuICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAkaHR0cC5wb3N0KCcvbG9naW4nLCAkc2NvcGUuZm9ybSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnNhdmVUb2tlbihyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvc2VhcmNoXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcbn1dKTtcbiIsIlxuLy9UaGlzIHNob3VsZCBnZXQgdGhlIHNlYXJjaCBpdGVtXG5hcHAuY29udHJvbGxlcignc2VhcmNoRnVuY3Rpb24nLCBbJyRzY29wZScsICckaHR0cCcsICdSZXN1bHRTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsIFJlc3VsdFNlcnZpY2UpIHtcbiAgICAkc2NvcGUuZm9ybUlucHV0PXt9O1xuXG4gICAgJHNjb3BlLnNlYXJjaEJ0biA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9wYXNzZXMgaW4gc2VhcmNoIHRleHQgdG8gc2VydmljZVxuICAgICAgIFJlc3VsdFNlcnZpY2UubWFrZURhdGFDYWxsKCRzY29wZS5mb3JtSW5wdXQuZGF0YSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBpbnB1dCB0ZXh0JywgJHNjb3BlLmZvcm1JbnB1dCk7XG4gICAgICAgIC8vZW1wdHlzIHRoZSBzZWFyY2ggYm94XG4gICAgICAgICRzY29wZS5mb3JtSW5wdXQ9e307XG4gICAgfTtcblxufV0pO1xuIiwiLy9UaGlzIHNlcnZpY2Ugc2hvdWxkIHBhc3MgZGF0YSBiZXR3ZWVuIGNvbnRyb2xsZXJzXG5hcHAuZmFjdG9yeSgnUmVzdWx0U2VydmljZScsIFsnJGh0dHAnLGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICB2YXIgYWR1bHRzID0gW107XG4gICAgdmFyIGNvbXBhbmllcyA9IFtdO1xuICAgIHZhciBraWRzID0gW107XG5cbiAgICB2YXIgbWFrZURhdGFDYWxsID0gZnVuY3Rpb24ocGFzc2VkRGF0YSkge1xuICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJy4uL3NlYXJjaCcsXG4gICAgICAgICAgICBwYXJhbXM6e3NlYXJjaDpwYXNzZWREYXRhfVxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICBnZXRDb21wYW5pZXMocmVzdWx0cyk7XG4gICAgICAgICAgICBnZXRLaWRzKHJlc3VsdHMpO1xuICAgICAgICAgICAgZ2V0QWR1bHRzKHJlc3VsdHMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRDb21wYW5pZXMgPSBmdW5jdGlvbihhcnJheSkge1xuICAgICAgICB2YXIgZ2V0RWxlbWVudDEgPSBmdW5jdGlvbihhcnJheSkge1xuICAgICAgICAgICAgY29tcGFuaWVzLnNwbGljZSgwLGNvbXBhbmllcy5sZW5ndGgpO1xuICAgICAgICAgICAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC50eXBlID09ICdjb21wYW55JylcbiAgICAgICAgICAgICAgICBjb21wYW5pZXMucHVzaChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG5cbiAgICAgICAgZ2V0RWxlbWVudDEoYXJyYXkpO1xuICAgICAgICBjb25zb2xlLmxvZygndGhpcyBpcyBnZXRFbGVtZW50MScsY29tcGFuaWVzKTtcbiAgICAgICAgcmV0dXJuIGNvbXBhbmllc1xuICAgIH07XG5cbiAgICB2YXIgZ2V0QWR1bHRzID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgICAgdmFyIGdldEVsZW1lbnQyID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgICAgICAgIGFkdWx0cy5zcGxpY2UoMCxhZHVsdHMubGVuZ3RoKTtcbiAgICAgICAgICAgIGFycmF5LmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PSAnYWR1bHQnKVxuICAgICAgICAgICAgICAgICAgICBhZHVsdHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG4gICAgICAgIGdldEVsZW1lbnQyKGFycmF5KTtcbiAgICAgICAgY29uc29sZS5sb2coJ3RoaXMgaXMgaW4gZ2V0RWxlbWVudDInLCBhZHVsdHMpO1xuICAgICAgICByZXR1cm4gYWR1bHRzXG4gICAgfTtcblxuICAgIHZhciBnZXRLaWRzID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgICAgdmFyIGdldEVsZW1lbnQzID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgICAgICAgIGtpZHMuc3BsaWNlKDAsa2lkcy5sZW5ndGgpO1xuICAgICAgICAgICAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC50eXBlID09ICdjaGlsZCcpXG4gICAgICAgICAgICAgICAgICAgIGtpZHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG4gICAgICAgIGdldEVsZW1lbnQzKGFycmF5KTtcbiAgICAgICAgY29uc29sZS5sb2coJ3RoaXMgaXMgZ2V0RWxlbWVudHMzJywga2lkcyk7XG4gICAgICAgIHJldHVybiBraWRzXG4gICAgfTtcblxuICAgIC8vcHVibGljXG4gICAgdmFyIHB1YmxpY0FwaSA9IHtcbiAgICAgICAgZ2V0S2lkczogZ2V0S2lkcyxcbiAgICAgICAgZ2V0QWR1bHRzOiBnZXRBZHVsdHMsXG4gICAgICAgIGdldENvbXBhbmllczogZ2V0Q29tcGFuaWVzLFxuICAgICAgICBtYWtlRGF0YUNhbGw6IG1ha2VEYXRhQ2FsbCxcbiAgICAgICAgcmVzdWx0czogcmVzdWx0cyxcbiAgICAgICAgY29tcGFuaWVzOiBjb21wYW5pZXMsXG4gICAgICAgIGFkdWx0czogYWR1bHRzLFxuICAgICAgICBraWRzOiBraWRzXG4gICAgfTtcbiAgICByZXR1cm4gcHVibGljQXBpO1xufV0pOyIsIi8vIFBsZWFzZSBub3RlIHRoYXQgJG1vZGFsSW5zdGFuY2UgcmVwcmVzZW50cyBhIG1vZGFsIHdpbmRvdyAoaW5zdGFuY2UpIGRlcGVuZGVuY3kuXG4vLyBJdCBpcyBub3QgdGhlIHNhbWUgYXMgdGhlICR1aWJNb2RhbCBzZXJ2aWNlIHVzZWQgYWJvdmUuXG5cbi8vbmVlZGVkIGZvciBtb2RhbD8/IHByZXR0eSBzdXJlXG5hcHAuY29udHJvbGxlcignTW9kYWxJbnN0YW5jZUN0cmwnLFsnJHNjb3BlJywnJG1vZGFsSW5zdGFuY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbW9kYWxJbnN0YW5jZSkge1xuXG4gICAgJHNjb3BlLm9rID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuc2VsZWN0ZWQuaXRlbSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRtb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICAgIH07XG59XSk7IiwiYXBwLmNvbnRyb2xsZXIoJ25hdkN0cmwnLCBbJ2F1dGhTZXJ2aWNlJywnJHNjb3BlJywnJHJvb3RTY29wZScsJyRsb2NhdGlvbicsIGZ1bmN0aW9uKGF1dGhTZXJ2aWNlLCAkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbil7XG4gICAgJHJvb3RTY29wZS51c2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xuXG4gICAgaWYoJHJvb3RTY29wZS51c2VyICYmICRyb290U2NvcGUudXNlci51c2VybmFtZSl7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaG9tZScpO1xuICAgIH1cblxuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpe1xuICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoKTtcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9cIik7XG4gICAgfVxufV0pO1xuIiwiLy8gQWpheCBmb3IgY3JlYXRpbmcgdGhlIGNvbnRhY3QgbGlzdCBpbiBjb25zdGFudCBjb250YWN0XG5cbmFwcC5jb250cm9sbGVyKCduZXdDb250YWN0TGlzdENvbnRyb2xsZXInLFsnbmV3Q29udGFjdExpc3REYXRhJywnJHNjb3BlJywnJGh0dHAnLCBmdW5jdGlvbihuZXdDb250YWN0TGlzdERhdGEsICRzY29wZSkge1xuXG4gICAgLy9kYXRhIHRvIGNyZWF0ZSBhIG5ldyBjb250YWN0IGxpc3RcblxuXG4gICAgJHNjb3BlLmxpc3RuYW1lID0ge307XG5cbiAgICAkc2NvcGUuY3JlYXRlTGlzdCAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY3JlYXRlIGxpc3Q6IFwiICsgJHNjb3BlLmxpc3RuYW1lLmlucHV0KTtcbiAgICAgICAgLy9wYXNzZXMgbGlzdCBuYW1lIHNlcnZpY2VcblxuICAgICAgICB2YXIgcHJvbWlzZSA9IG5ld0NvbnRhY3RMaXN0RGF0YS5wb3N0TGlzdCgkc2NvcGUubGlzdG5hbWUuaW5wdXQpO1xuXG4gICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICBsaXN0TnVtID0gdG9TdHJpbmcoZGF0YS5pZCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIklkPyBcIixkYXRhLmlkKTtcblxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcImxpc3QgI1wiLCAkc2NvcGUubGlzdE51bSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibGlzdCB0eXBlXCIsIHR5cGVvZiAkc2NvcGUubGlzdE51bSk7XG5cbiAgICAgICAgJHNjb3BlLmxpc3RuYW1lPXt9O1xuICAgIH07XG59XSk7XG5cblxuIiwiLy9zZXJ2aWNlIGZvciBhamF4IGNhbGxzIHRvIGNvbnN0YW50IGNvbnRhY3RcblxuXG5hcHAuc2VydmljZSgnbmV3Q29udGFjdExpc3REYXRhJywgWydDb250YWN0TGlzdERhdGFTZXJ2aWNlJywgJyRodHRwJyxcbiAgICBmdW5jdGlvbiAoQ29udGFjdExpc3REYXRhU2VydmljZSwgJGh0dHApIHtcblxuICAgIHRoaXMubmV3Q29udGFjdExpc3QgPSBbXTtcbiAgICB0aGlzLmxpc3ROdW0gPSBcIlwiO1xuXG4gICAgdGhpcy5wb3N0TGlzdCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZGlkIHRoZSBuYW1lIG1ha2UgaXQgdG8gdGhlIHNlcnZpY2U/IFwiICsgbmFtZSApO1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL25ld0NvbnRhY3RMaXN0Jywge25hbWU6IG5hbWV9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIGxpc3ROdW0gPSB0b1N0cmluZyhkYXRhLmlkKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSWQ/IFwiLGRhdGEuaWQpO1xuXG4gICAgICAgIH0sIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7IC8vZXJyb3JcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuaW1wb3J0RGF0YUFycmF5ID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICBcImVtYWlsX2FkZHJlc3Nlc1wiOiBbXG4gICAgICAgICAgICAgICAgXCJ1c2VyMUBleGFtcGxlLmNvbVwiXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgXCJmaXJzdF9uYW1lXCI6IFwiSm9oblwiLFxuICAgICAgICAgICAgXCJsYXN0X25hbWVcIjogXCJTbWl0aFwiLFxuICAgICAgICAgICAgXCJjb21wYW55X25hbWVcIjogXCJDb21wYW55IFhcIixcbiAgICAgICAgICAgIFwiYWRkcmVzc2VzXCI6IFt7XG4gICAgICAgICAgICAgICAgY2l0eTogXCJhbnl0b3duXCJcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiZW1haWxfYWRkcmVzc2VzXCI6IFtcbiAgICAgICAgICAgICAgICBcInVzZXIyQGV4YW1wbGUuY29tXCJcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBcImZpcnN0X25hbWVcIjogXCJKYW5lXCIsXG4gICAgICAgICAgICBcImxhc3RfbmFtZVwiOiBcIlNtaXRoeVwiLFxuICAgICAgICAgICAgXCJjb21wYW55X25hbWVcIjogXCJDb21wYW55IFlcIixcbiAgICAgICAgICAgIFwiYWRkcmVzc2VzXCI6IFt7XG4gICAgICAgICAgICAgICAgY2l0eTogXCJzb21ldG93blwiXG4gICAgICAgICAgICB9XVxuICAgICAgICB9XG4gICAgXTtcblxuICAgIC8vdmFyIGNvbnRhY3RMaXN0T2JqZWN0ID0oe1xuICAgIC8vICAgIFwiSW1wb3J0IERhdGFcIiA6IGltcG9ydERhdGFBcnJheSxcbiAgICAvLyAgICBcImxpc3RcIjogW2xpc3ROdW1dLFxuICAgIC8vICAgIFwiY29sdW1uX25hbWVzXCI6W1wiRU1BSUxcIixcIkZJUlNUIE5BTUVcIiwgXCJMQVNUIE5BTUVcIiwgXCJDSVRZXCIsXCJDT01QQU5ZIE5BTUVcIl19KTtcblxuXG4gICAgdGhpcy5wb3BMaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBnZXRDaGVja2VkKCk7XG4gICAgICAgICRodHRwLnBvc3QoJy9wb3B1bGF0ZUNvbnRhY3RMaXN0LmpzJywgaW1wb3J0RGF0YUFycmF5LCBsaXN0TnVtKS50aGVuKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmxvZyhvcHRpb25zKTtcblxuICAgIH07XG5cbiAgICAvL2dldCBhbGwgdGhlIGNoZWNrZWQgZWxlbWVudHMgYW5kIHN0dWZmIHRoZW0gaW4gYW4gYXJyYXlcbiAgICB2YXIgZ2V0Q2hlY2tlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCI6Y2hlY2tlZC50eXBlLWVsZW1lbnRcIikuZWFjaChcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSBDb250YWN0TGlzdERhdGFTZXJ2aWNlLnJlc3VsdHMuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb250YWN0T2JqZWN0ID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsX2FkZHJlc3Nlc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZW1haWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmlyc3RfbmFtZVwiOiAkKHRoaXMpLmZpcnN0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhc3RfbmFtZVwiOiAkKHRoaXMpLmxhc3ROYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY29tcGFueV9uYW1lXCI6ICQodGhpcykuY29tcGFueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFkZHJlc3Nlc1wiOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXR5OiAkKHRoaXMpLmNpdHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydERhdGFBcnJheS5wdXNoKGNvbnRhY3RPYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG59XSk7IiwiYXBwLmNvbnRyb2xsZXIoJ3BvcExpc3RDb250cm9sbGVyJyxbJ25ld0NvbnRhY3RMaXN0RGF0YScsJyRzY29wZScsJyRodHRwJywgZnVuY3Rpb24obmV3Q29udGFjdExpc3REYXRhLCAkc2NvcGUsICRodHRwKSB7XG4gICAgLy9kYXRhIHRvIGNyZWF0ZSBhIG5ldyBjb250YWN0IGxpc3RcblxuXG4gICAgJHNjb3BlLmxpc3ROYW1lID0ge307XG5cbiAgICAkc2NvcGUucG9wdWxhdGVMaXN0ICA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjcmVhdGUgbGlzdDogXCIgKyBzY29wZS5saXN0TmFtZS5pbnB1dCk7XG4gICAgICAgIC8vcGFzc2VzIGluIHNlYXJjaCB0ZXh0IHRvIHNlcnZpY2VcbiAgICAgICAgbmV3Q29udGFjdExpc3REYXRhLnBvcExpc3QoKTtcbiAgICAgICAgLy92YXIgbGlzdEVuZCA9IHtcbiAgICAgICAgLy8gICAgXCJsaXN0c1wiOiBbbGlzdE51bV0sXG4gICAgICAgIC8vICAgIFwiY29sdW1uX25hbWVzXCI6IFtcbiAgICAgICAgLy8gICAgXCJFTUFJTFwiLFxuICAgICAgICAvLyAgICBcIkZJUlNUIE5BTUVcIixcbiAgICAgICAgLy8gICAgXCJMQVNUIE5BTUVcIixcbiAgICAgICAgLy8gICAgXCJDSVRZXCIsXG4gICAgICAgIC8vICAgIFwiQ09NUEFOWSBOQU1FXCJcbiAgICAgICAgLy9dfVxuXG5cbiAgICAgICAgJHNjb3BlLmxpc3ROYW1lPXt9O1xuICAgIH07XG59XSk7XG5cbiIsIlxuLy9yZWdpc3RlciBjb250cm9sbGVyXG5hcHAuY29udHJvbGxlcigncmVnaXN0ZXJDdHJsJywgWyAnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsICBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJyZWdpc3RlckN0cmxcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZWdpc3RlckNvbnRyb2xsZXIgc3VibWl0OicsICRzY29wZS5mb3JtKTtcbiAgICAgICAgJGh0dHAucG9zdCgnL3JlZ2lzdGVyJywgJHNjb3BlLmZvcm0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvaW5kZXhcIilcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbn1dKTtcbiIsImFwcC5jb250cm9sbGVyKCdyZXNldEN0cmwnLCBbICckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHtcbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnZWRpdCBwYXNzd29yZDonLCAkc2NvcGUuZm9ybSk7XG4gICAgICAgICRodHRwLnB1dCgnL2FkbWluJywgJHNjb3BlLmZvcm0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvaW5kZXhcIilcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbn1dKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
