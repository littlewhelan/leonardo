function formatDates(t){return{full:moment(t).format(fullDate),pretty:moment(t).format(prettyDate)}}var app=angular.module("leo",["ngRoute","ngAnimate","ui.bootstrap"]),prettyDate="MM/DD/YYgYY",fullDate="MM/DD/YYYY h:mm:ss a";app.config(["$routeProvider",function(t){t.when("/",{templateUrl:"static/login.html"}).when("/search",{templateUrl:"private/search.html"}).when("/register",{templateUrl:"static/register.html"}).when("/contactList",{templateUrl:"private/contactList.html"}).when("/addfamily",{templateUrl:"private/addfamily.html"}).when("/addcorp",{templateUrl:"private/addcorp.html"}).when("/contactlist",{templateUrl:"private/contactlist.html"}).otherwise({redirectTo:"/search"})}]),app.factory("authInterceptor",["$q","$location","authService",function(t,e,n){return{request:function(t){return t.headers=t.headers||{},n.isAuthed()&&(t.headers.Authorization="Bearer "+n.getToken()),t},response:function(n){return 401===n.status&&e.path("/"),n||t.when(n)},responseError:function(n){return 401===n.status?e.path("/"):console.log(n.status),t.reject(n)}}}]),app.service("authService",["$window",function(t){this.parseJwt=function(e){if(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))}return{}},this.saveToken=function(e){t.localStorage.jwtToken=e},this.getToken=function(){return t.localStorage.jwtToken},this.isAuthed=function(){var t=this.getToken();if(t){var e=this.parseJwt(t),n=Math.round((new Date).getTime()/1e3)<=e.exp;return n||this.logout(),n}return!1},this.logout=function(){delete t.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.controller("editCorpCtrl",["$scope","$uibModal","$log","ResultService","$http",function(t,e,n,o,a){t.companies=o.companies,t.animationsEnabled=!0,t.open=function(o,i){return console.log("corp call",i),a({method:"GET",url:"../corporation",params:{id:i}}).then(function(a){t.company=a.data;var i=e.open({animation:t.animationsEnabled,templateUrl:"private/editcorp.html",controller:"ModalInstanceCtrl",size:o,scope:t,resolve:{items:function(){return t.company}}});i.result.then(function(e){t.selected=e},function(){n.info("Modal dismissed at: "+new Date)})})},t.toggleAnimation=function(){t.animationsEnabled=!t.animationsEnabled}}]),app.controller("createListSearch",["$scope","$http","ContactListDataService",function(t,e,n){t.corp={},t.fam={},t.zipCk={},t.ageCk={},t.age={},t.zip={},console.log("Where is this",t.corp,t.fam,t.zipCk,t.ageCk),t.emailList=[],t.searchListBtn=function(){if(1==t.zipCk&&n.makeDataCall("zip",t.zip.data).then(function(e){t.emailList=e,console.log(t.emailList)}),1==t.ageCk){var e=n.makeDataCall("age",t.age.data);e.then(function(e){console.log(e),t.emailList=e})}if(1==t.fam){var o=n.makeDataCall("family","");o.then(function(e){t.emailList=e,console.log(e)})}if(1==t.corp){var a=n.makeDataCall("company","");a.then(function(e){t.emailList=e,console.log(e)})}t.corp={},t.fam={},t.zipCk={},t.ageCk={},t.age={},t.zip={}}}]),app.factory("ContactListDataService",["$http","$q",function(t,e){function n(n,o){var a=e.defer();return console.log("this is in the make data call",n,o),t({method:"GET",url:"../createMailList",params:{type:n,search:o}}).then(function(t){data=t.data,a.resolve(t.data)}),a.promise}return{data:[],makeDataCall:n}}]),app.controller("editFamilyCtrl",["$scope","$uibModal","$log","ResultService","$http",function(t,e,n,o,a){t.adults=o.adults,t.kids=o.kids,t.animationsEnabled=!0,t.open=function(o,i){return console.log("family call",i),a({method:"GET",url:"../family",params:{id:i}}).then(function(a){t.family=a.data;var i=e.open({animation:t.animationsEnabled,templateUrl:"private/editfamily.html",controller:"ModalInstanceCtrl",size:o,scope:t,resolve:{items:function(){return t.family}}});i.result.then(function(e){t.selected=e},function(){n.info("Modal dismissed at: "+new Date)})})},t.toggleAnimation=function(){t.animationsEnabled=!t.animationsEnabled}}]),app.controller("loginCtrl",["$scope","$http","authService","$location","$rootScope",function(t,e,n,o,a){t.submit=function(){e.post("/login",t.form).then(function(t){n.saveToken(t.data),a.user=n.getUser(),o.path("/search")})}}]),app.controller("searchFunction",["$scope","$http","ResultService",function(t,e,n){t.formInput={},t.searchBtn=function(){n.makeDataCall(t.formInput.data),console.log("this is the input text",t.formInput),t.formInput={}}}]),app.factory("ResultService",["$http",function(t){var e=[],n=[],o=[],a=[],i=function(n){return t({method:"GET",url:"../search",params:{search:n}}).then(function(t){e=t.data,s(e),l(e),r(e)})},s=function(t){var e=function(t){o.splice(0,o.length),t.forEach(function(t){"company"==t.type&&o.push(t)})};return e(t),console.log("this is getElement1",o),o},r=function(t){var e=function(t){n.splice(0,n.length),t.forEach(function(t){"adult"==t.type&&n.push(t)})};return e(t),console.log("this is in getElement2",n),n},l=function(t){var e=function(t){a.splice(0,a.length),t.forEach(function(t){"child"==t.type&&a.push(t)})};return e(t),console.log("this is getElements3",a),a},c={getKids:l,getAdults:r,getCompanies:s,makeDataCall:i,results:e,companies:o,adults:n,kids:a};return c}]),app.controller("ModalInstanceCtrl",["$scope","$modalInstance",function(t,e){t.ok=function(){e.close(t.selected.item)},t.cancel=function(){e.dismiss("cancel")}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location",function(t,e,n,o){n.user=t.getUser(),n.user&&n.user.username&&o.path("/home"),e.logout=function(){t.logout(),n.user=t.getUser(),o.path("/")}}]),app.controller("newContactListController",["newContactListData","$scope",function(t,e){e.listname={},e.createList=function(){console.log("create list: "+e.listname.input),t.postList(e.listname.input),console.log("list #",t.listNum),e.listname={}}}]),app.service("newContactListData",["ContactListDataService","$http",function(t,e){this.newContactList=[],this.listNum="0",this.postList=function(t){return console.log("did the name make it to the service? "+t),e.post("/newContactList",{name:t}).then(function(t){console.log(t.data),listNum=t.data,console.log("Id? ",listNum)},function(t){console.log(t)})},this.importDataArray=[{email_addresses:["user1@example.com"],first_name:"John",last_name:"Smith",company_name:"Company X",addresses:[{city:"anytown"}]},{email_addresses:["user2@example.com"],first_name:"Jane",last_name:"Smithy",company_name:"Company Y",addresses:[{city:"sometown"}]}],this.popList=function(){n(),e.post("/populateContactList.js",importDataArray,listNum).then(function(t,e,n,o){console.log(t)}),console.log(options)};var n=function(){$(":checked.type-element").each(function(){if(id==t.results.id){var e={email_addresses:[$(this).email],first_name:$(this).firstName,last_name:$(this).lastName,company_name:$(this).company,addresses:[{city:$(this).city}]};importDataArray.push(e)}})}}]),app.controller("popListController",["newContactListData","$scope","$http",function(t,e,n){e.listName={},e.populateList=function(){console.log("create list: "+scope.listName.input),t.popList(),e.listName={}}}]),app.controller("registerCtrl",["$scope","$http","$location",function(t,e,n){t.submit=function(){console.log("registerCtrl"),console.log("registerController submit:",t.form),e.post("/register",t.form).then(function(t){console.log(t),n.path("/index")})}}]),app.controller("resetCtrl",["$scope","$http","$location",function(t,e,n){t.submit=function(){console.log("edit password:",t.form),e.put("/admin",t.form).then(function(t){console.log(t),n.path("/index")})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImF1dGhJbnRlcmNlcHRvci5qcyIsImF1dGhTZXJ2aWNlLmpzIiwiY29ycENvbnRyb2xsZXIuanMiLCJjcmVhdGVMaXN0Q29udG9sbGVyLmpzIiwiY3JlYXRlTGlzdFNlcnZpY2UuanMiLCJmYW1pbHlDb250cm9sbGVyLmpzIiwibG9naW5Db250cm9sbGVyLmpzIiwibWFpblNlYXJjaENvbnRyb2xsZXIuanMiLCJtYWluU2VhcmNoU2VydmljZS5qcyIsIm1vZGFsSW5zdGFuY2VDb250cm9sbGVyLmpzIiwibmF2Q29udHJvbGxlci5qcyIsIm5ld0NvbnRhY3RMaXN0Q29udHJvbGxlci5qcyIsIm5ld0NvbnRhY3RMaXN0U2VydmljZS5qcyIsInBvcExpc3RDb250cm9sbGVyLmpzIiwicmVnaXN0ZXJDb250cm9sbGVyLmpzIiwicmVzZXRDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImZvcm1hdERhdGVzIiwiZGF0ZSIsImZ1bGwiLCJtb21lbnQiLCJmb3JtYXQiLCJmdWxsRGF0ZSIsInByZXR0eSIsInByZXR0eURhdGUiLCJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwiZmFjdG9yeSIsIiRxIiwiJGxvY2F0aW9uIiwiYXV0aFNlcnZpY2UiLCJyZXF1ZXN0IiwiaGVhZGVycyIsImlzQXV0aGVkIiwiQXV0aG9yaXphdGlvbiIsImdldFRva2VuIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJwYXRoIiwicmVzcG9uc2VFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJyZWplY3QiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJwYXJzZUp3dCIsInRva2VuIiwiYmFzZTY0VXJsIiwic3BsaXQiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsInNhdmVUb2tlbiIsImxvY2FsU3RvcmFnZSIsImp3dFRva2VuIiwicGFyYW1zIiwibm90RXhwaXJlZCIsIk1hdGgiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwibG9nb3V0IiwiZ2V0VXNlciIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkdWliTW9kYWwiLCIkbG9nIiwiUmVzdWx0U2VydmljZSIsIiRodHRwIiwiY29tcGFuaWVzIiwiYW5pbWF0aW9uc0VuYWJsZWQiLCJvcGVuIiwic2l6ZSIsImlkIiwibWV0aG9kIiwidXJsIiwidGhlbiIsImNvbXBhbnkiLCJkYXRhIiwibW9kYWxJbnN0YW5jZSIsImFuaW1hdGlvbiIsInNjb3BlIiwicmVzb2x2ZSIsIml0ZW1zIiwicmVzdWx0Iiwic2VsZWN0ZWRJdGVtIiwic2VsZWN0ZWQiLCJpbmZvIiwidG9nZ2xlQW5pbWF0aW9uIiwiQ29udGFjdExpc3REYXRhU2VydmljZSIsImNvcnAiLCJmYW0iLCJ6aXBDayIsImFnZUNrIiwiYWdlIiwiemlwIiwiZW1haWxMaXN0Iiwic2VhcmNoTGlzdEJ0biIsIm1ha2VEYXRhQ2FsbCIsImNvbXAiLCJ0eXBlIiwicGFzc2VkRGF0YSIsImRlZmVycmVkIiwiZGVmZXIiLCJzZWFyY2giLCJwcm9taXNlIiwiYWR1bHRzIiwia2lkcyIsImZhbWlseSIsIiRyb290U2NvcGUiLCJzdWJtaXQiLCJwb3N0IiwiZm9ybSIsInVzZXIiLCJmb3JtSW5wdXQiLCJzZWFyY2hCdG4iLCJyZXN1bHRzIiwiZ2V0Q29tcGFuaWVzIiwiZ2V0S2lkcyIsImdldEFkdWx0cyIsImFycmF5IiwiZ2V0RWxlbWVudDEiLCJzcGxpY2UiLCJsZW5ndGgiLCJmb3JFYWNoIiwiZWxlbWVudCIsInB1c2giLCJnZXRFbGVtZW50MiIsImdldEVsZW1lbnQzIiwicHVibGljQXBpIiwiJG1vZGFsSW5zdGFuY2UiLCJvayIsImNsb3NlIiwiaXRlbSIsImNhbmNlbCIsImRpc21pc3MiLCJ1c2VybmFtZSIsIm5ld0NvbnRhY3RMaXN0RGF0YSIsImxpc3RuYW1lIiwiY3JlYXRlTGlzdCIsImlucHV0IiwicG9zdExpc3QiLCJsaXN0TnVtIiwibmV3Q29udGFjdExpc3QiLCJuYW1lIiwiaW1wb3J0RGF0YUFycmF5IiwiZW1haWxfYWRkcmVzc2VzIiwiZmlyc3RfbmFtZSIsImxhc3RfbmFtZSIsImNvbXBhbnlfbmFtZSIsImFkZHJlc3NlcyIsImNpdHkiLCJwb3BMaXN0IiwiZ2V0Q2hlY2tlZCIsIm9wdGlvbnMiLCIkIiwiZWFjaCIsImNvbnRhY3RPYmplY3QiLCJlbWFpbCIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwibGlzdE5hbWUiLCJwb3B1bGF0ZUxpc3QiLCJwdXQiXSwibWFwcGluZ3MiOiJBQUtBLFFBQUFBLGFBQUFDLEdBQ0EsT0FDQUMsS0FBQUMsT0FBQUYsR0FBQUcsT0FBQUMsVUFDQUMsT0FBQUgsT0FBQUYsR0FBQUcsT0FBQUcsYUFSQSxHQUFBQyxLQUFBQyxRQUFBQyxPQUFBLE9BQUEsVUFBQSxZQUFBLGlCQUVBSCxXQUFBLGNBQ0FGLFNBQUEsc0JBU0FHLEtBQUFHLFFBQUEsaUJBQ0EsU0FBQUMsR0FDQUEsRUFDQUMsS0FBQSxLQUNBQyxZQUFBLHNCQUVBRCxLQUFBLFdBQ0FDLFlBQUEsd0JBRUFELEtBQUEsYUFDQUMsWUFBQSx5QkFFQUQsS0FBQSxnQkFDQUMsWUFBQSw2QkFFQUQsS0FBQSxjQUNBQyxZQUFBLDJCQUVBRCxLQUFBLFlBQ0FDLFlBQUEseUJBRUFELEtBQUEsZ0JBQ0FDLFlBQUEsNkJBRUFDLFdBQ0FDLFdBQUEsZUNyQ0FSLElBQUFTLFFBQUEsbUJBQUEsS0FBQSxZQUFBLGNBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxPQUNBQyxRQUFBLFNBQUFWLEdBS0EsTUFKQUEsR0FBQVcsUUFBQVgsRUFBQVcsWUFDQUYsRUFBQUcsYUFDQVosRUFBQVcsUUFBQUUsY0FBQSxVQUFBSixFQUFBSyxZQUVBZCxHQUVBZSxTQUFBLFNBQUFBLEdBT0EsTUFMQSxPQUFBQSxFQUFBQyxRQUdBUixFQUFBUyxLQUFBLEtBRUFGLEdBQUFSLEVBQUFMLEtBQUFhLElBQ0FHLGNBQUEsU0FBQUgsR0FTQSxNQVJBLE9B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cUgsT0FFQVgsV0FBQVEsRUFBQWxILE1BQUFzSCxVQUNBWCxVQUFBTyxFQUFBbEgsTUFBQXVILFNBQ0FYLGFBQUFNLEVBQUFsSCxNQUFBb0MsUUFDQXlFLFlBQ0FDLEtBQUFJLEVBQUFsSCxNQUFBOEcsT0FHQU4saUJBQUFuQixLQUFBK0IsVUM5REEvSSxJQUFBaUQsV0FBQSxxQkFBQSxxQkFBQSxTQUFBLFFBQUEsU0FBQTBFLEVBQUF6RSxFQUFBSSxHQUlBSixFQUFBaUcsWUFFQWpHLEVBQUFrRyxhQUFBLFdBQ0E5SCxRQUFBQyxJQUFBLGdCQUFBNEMsTUFBQWdGLFNBQUFyQixPQUVBSCxFQUFBZSxVQVlBeEYsRUFBQWlHLGdCQ25CQW5KLElBQUFpRCxXQUFBLGdCQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUFDLEVBQUFJLEVBQUEzQyxHQUNBdUMsRUFBQThDLE9BQUEsV0FDQTFFLFFBQUFDLElBQUEsZ0JBQ0FELFFBQUFDLElBQUEsNkJBQUEyQixFQUFBZ0QsTUFDQTVDLEVBQUEyQyxLQUFBLFlBQUEvQyxFQUFBZ0QsTUFDQXBDLEtBQUEsU0FBQTVDLEdBQ0FJLFFBQUFDLElBQUFMLEdBQ0FQLEVBQUFTLEtBQUEsZ0JDVEFwQixJQUFBaUQsV0FBQSxhQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUFDLEVBQUFJLEVBQUEzQyxHQUNBdUMsRUFBQThDLE9BQUEsV0FDQTFFLFFBQUFDLElBQUEsaUJBQUEyQixFQUFBZ0QsTUFDQTVDLEVBQUErRixJQUFBLFNBQUFuRyxFQUFBZ0QsTUFDQXBDLEtBQUEsU0FBQTVDLEdBQ0FJLFFBQUFDLElBQUFMLEdBQ0FQLEVBQUFTLEtBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbGVvJywgWyduZ1JvdXRlJywgJ25nQW5pbWF0ZScsICd1aS5ib290c3RyYXAnXSk7XG5cbnZhciBwcmV0dHlEYXRlID0gXCJNTS9ERC9ZWWdZWVwiO1xudmFyIGZ1bGxEYXRlID0gXCJNTS9ERC9ZWVlZIGg6bW06c3MgYVwiO1xuXG5mdW5jdGlvbiBmb3JtYXREYXRlcyAoZGF0ZSkge1xuXHRyZXR1cm4ge1xuXHRcdGZ1bGw6IG1vbWVudChkYXRlKS5mb3JtYXQoZnVsbERhdGUpLFxuXHRcdHByZXR0eTogbW9tZW50KGRhdGUpLmZvcm1hdChwcmV0dHlEYXRlKVxuXHR9O1xufVxuXG5hcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLFxuICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLlxuICAgICAgICAgICAgd2hlbignLycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3N0YXRpYy9sb2dpbi5odG1sJ1xuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICB3aGVuKCcvc2VhcmNoJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncHJpdmF0ZS9zZWFyY2guaHRtbCdcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgd2hlbignL3JlZ2lzdGVyJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc3RhdGljL3JlZ2lzdGVyLmh0bWwnXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIHdoZW4oJy9jb250YWN0TGlzdCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ByaXZhdGUvY29udGFjdExpc3QuaHRtbCdcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgd2hlbignL2FkZGZhbWlseScsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ByaXZhdGUvYWRkZmFtaWx5Lmh0bWwnXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIHdoZW4oJy9hZGRjb3JwJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncHJpdmF0ZS9hZGRjb3JwLmh0bWwnXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIHdoZW4oJy9jb250YWN0bGlzdCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ByaXZhdGUvY29udGFjdGxpc3QuaHRtbCdcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgb3RoZXJ3aXNlKHtcbiAgICAgICAgICAgICAgICByZWRpcmVjdFRvOiAnL3NlYXJjaCdcbiAgICAgICAgICAgIH0pO1xuICAgIH1dKTtcblxuXG5cblxuIiwiYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xuICAgICAgICB9LCByZXNwb25zZUVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH07XG59XSkiLCJhcHAuc2VydmljZSgnYXV0aFNlcnZpY2UnLCBbJyR3aW5kb3cnLCBmdW5jdGlvbiAoJHdpbmRvdykge1xuXG4gICAgdGhpcy5wYXJzZUp3dCA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBiYXNlNjRVcmwgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xuICAgICAgICAgICAgdmFyIGJhc2U2NCA9IGJhc2U2NFVybC5yZXBsYWNlKCctJywgJysnKS5yZXBsYWNlKCdfJywgJy8nKTtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cuYXRvYihiYXNlNjQpKTtcbiAgICAgICAgfSBlbHNlIHJldHVybiB7fTtcbiAgICB9O1xuXG4gICAgdGhpcy5zYXZlVG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW4gPSB0b2tlbjtcbiAgICAgICAgLy9jb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKTsiLCIvL2VkaXQgY29ycG9yYXRpb24gbW9kYWwgdGVtcGxhdGVcbmFwcC5jb250cm9sbGVyKCdlZGl0Q29ycEN0cmwnLCBbJyRzY29wZScsICckdWliTW9kYWwnLCAnJGxvZycsICdSZXN1bHRTZXJ2aWNlJywgJyRodHRwJywgZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsLCAkbG9nLCBSZXN1bHRTZXJ2aWNlLCAkaHR0cCkge1xuICAgIC8vc2VuZHMgdGhlIGNvbXBhbmllcyBhZnRlciB0aGUgcmVzdWx0cyBoYXZlIGJlZW4gb3JnYW5pemVkXG4gICAgICAgICRzY29wZS5jb21wYW5pZXMgPSBSZXN1bHRTZXJ2aWNlLmNvbXBhbmllcztcblxuICAgICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCA9IHRydWU7XG5cbiAgICAkc2NvcGUub3BlbiA9IGZ1bmN0aW9uIChzaXplLCBpZCkge1xuICAgICAgICBjb25zb2xlLmxvZygnY29ycCBjYWxsJywgaWQpO1xuICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJy4uL2NvcnBvcmF0aW9uJyxcbiAgICAgICAgICAgIHBhcmFtczp7aWQ6aWR9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUuY29tcGFueSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ByaXZhdGUvZWRpdGNvcnAuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNb2RhbEluc3RhbmNlQ3RybCcsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IHNpemUsXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jb21wYW55O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHNlbGVjdGVkSXRlbSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZCA9IHNlbGVjdGVkSXRlbTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkbG9nLmluZm8oJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUudG9nZ2xlQW5pbWF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQgPSAhJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkO1xuICAgIH07XG5cblxufV0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ2NyZWF0ZUxpc3RTZWFyY2gnLCBbJyRzY29wZScsICckaHR0cCcsICdDb250YWN0TGlzdERhdGFTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsIENvbnRhY3RMaXN0RGF0YVNlcnZpY2UpIHtcbiAgICAkc2NvcGUuY29ycCA9IHt9O1xuICAgICRzY29wZS5mYW0gPSB7fTtcbiAgICAkc2NvcGUuemlwQ2sgPSB7fTtcbiAgICAkc2NvcGUuYWdlQ2sgPSB7fTtcbiAgICAkc2NvcGUuYWdlID0ge307XG4gICAgJHNjb3BlLnppcCA9IHt9O1xuICAgIGNvbnNvbGUubG9nKCdXaGVyZSBpcyB0aGlzJyxcbiAgICAgICAgJHNjb3BlLmNvcnAsXG4gICAgICAgICRzY29wZS5mYW0sXG4gICAgICAgICRzY29wZS56aXBDayxcbiAgICAgICAgJHNjb3BlLmFnZUNrXG4gICAgKTtcblxuICAgICRzY29wZS5lbWFpbExpc3QgPSBbIF07XG5cbiAgICAkc2NvcGUuc2VhcmNoTGlzdEJ0biA9IGZ1bmN0aW9uICgpIHtcblxuXG4gICAgICAgIC8vVEhJUyBXT1JLUyAgLS0gd2lsbCBzZWFyY2ggYnkgemlwXG4gICAgICAgIGlmICgkc2NvcGUuemlwQ2sgPT0gdHJ1ZSkge1xuXG4gICAgICAgICAgICBDb250YWN0TGlzdERhdGFTZXJ2aWNlLm1ha2VEYXRhQ2FsbCgnemlwJywgJHNjb3BlLnppcC5kYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lbWFpbExpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZW1haWxMaXN0KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9XG5cblxuICAgICAgICAvL1RISVMgV09SS1MgLSB3aWxsIHNlYXJjaCBieSBhZ2VcbiAgICAgICAgaWYgKCRzY29wZS5hZ2VDayA9PSB0cnVlKSB7XG4gICAgICAgICAgICB2YXIgYWdlID0gQ29udGFjdExpc3REYXRhU2VydmljZS5tYWtlRGF0YUNhbGwoJ2FnZScsICRzY29wZS5hZ2UuZGF0YSk7XG4gICAgICAgICAgICBhZ2UudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lbWFpbExpc3QgPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL1RISVMgV09SS1MgLS1nZXQgYWxsIGZhbWlsaWVzIGlmIGZhbSBpcyB0cnVlXG4gICAgICAgIGlmICgkc2NvcGUuZmFtID09IHRydWUpIHtcbiAgICAgICAgICAgIHZhciBmYW0gPSBDb250YWN0TGlzdERhdGFTZXJ2aWNlLm1ha2VEYXRhQ2FsbCgnZmFtaWx5JywgJycpO1xuICAgICAgICAgICAgZmFtLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZW1haWxMaXN0ID0gZGF0YTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgYWxsIGNvcnAgaWYgY29ycCBpcyB0cnVlXG4gICAgICAgIGlmICgkc2NvcGUuY29ycCA9PSB0cnVlKSB7XG4gICAgICAgICAgICB2YXIgY29tcCA9IENvbnRhY3RMaXN0RGF0YVNlcnZpY2UubWFrZURhdGFDYWxsKCdjb21wYW55JywgJycpO1xuICAgICAgICAgICAgY29tcC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVtYWlsTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZW1wdHkgdGhlIHNlYXJjaCBib3hcbiAgICAgICAgJHNjb3BlLmNvcnAgPSB7fTtcbiAgICAgICAgJHNjb3BlLmZhbSA9IHt9O1xuICAgICAgICAkc2NvcGUuemlwQ2sgPSB7fTtcbiAgICAgICAgJHNjb3BlLmFnZUNrID0ge307XG4gICAgICAgICRzY29wZS5hZ2UgPSB7fTtcbiAgICAgICAgJHNjb3BlLnppcCA9IHt9O1xuXG5cbiAgICB9O1xuXG5cbn1dKTsiLCJhcHAuZmFjdG9yeSgnQ29udGFjdExpc3REYXRhU2VydmljZScsIFsnJGh0dHAnLCAnJHEnLCBmdW5jdGlvbiAoJGh0dHAsICRxKSB7XG5cbiAgICBmdW5jdGlvbiBtYWtlRGF0YUNhbGwodHlwZSwgcGFzc2VkRGF0YSkge1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICBjb25zb2xlLmxvZygndGhpcyBpcyBpbiB0aGUgbWFrZSBkYXRhIGNhbGwnLCB0eXBlLCBwYXNzZWREYXRhKTtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogJy4uL2NyZWF0ZU1haWxMaXN0JyxcbiAgICAgICAgICAgIHBhcmFtczoge3R5cGU6IHR5cGUsIHNlYXJjaDogcGFzc2VkRGF0YX1cbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGRhdGE6IFtdLFxuICAgICAgICBtYWtlRGF0YUNhbGw6IG1ha2VEYXRhQ2FsbFxuICAgIH07XG5cblxufV0pOyIsIi8vZWRpdCBmYW1pbHkgbW9kYWwgdGVtcGxhdGVcbmFwcC5jb250cm9sbGVyKCdlZGl0RmFtaWx5Q3RybCcsWyckc2NvcGUnLCAnJHVpYk1vZGFsJywgJyRsb2cnLCdSZXN1bHRTZXJ2aWNlJywgJyRodHRwJywgZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsLCAkbG9nLCBSZXN1bHRTZXJ2aWNlLCAkaHR0cCkge1xuXG4gICAgLy9zZW5kcyB0aGUgYWR1bHRzIGFuZCBraWRzIGFmdGVyIHRoZSByZXN1bHRzIGhhdmUgYmVlbiBvcmdhbml6ZWRcbiAgICAgICAgJHNjb3BlLmFkdWx0cyA9IFJlc3VsdFNlcnZpY2UuYWR1bHRzO1xuICAgICAgICAkc2NvcGUua2lkcyA9IFJlc3VsdFNlcnZpY2Uua2lkcztcblxuICAgICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCA9IHRydWU7XG4gICAgICAgICRzY29wZS5vcGVuID0gZnVuY3Rpb24gKHNpemUsIGlkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZmFtaWx5IGNhbGwnLGlkKTtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcuLi9mYW1pbHknLFxuICAgICAgICAgICAgICAgIHBhcmFtczp7aWQ6aWR9XG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgIFx0XHRcdCRzY29wZS5mYW1pbHkgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwcml2YXRlL2VkaXRmYW1pbHkuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTW9kYWxJbnN0YW5jZUN0cmwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSxcbiAgICAgICAgICAgICAgXHRcdFx0XHRzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZmFtaWx5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChzZWxlY3RlZEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJGxvZy5pbmZvKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlQW5pbWF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCA9ICEkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQ7XG4gICAgICAgICAgICB9O1xuXG5cbn1dKTsiLCIvL2NvbnRyb2xsZXJzIGZvciBsb2dpblxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgJ2F1dGhTZXJ2aWNlJywgJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgYXV0aFNlcnZpY2UsICRsb2NhdGlvbiwgJHJvb3RTY29wZSl7XG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRodHRwLnBvc3QoJy9sb2dpbicsICRzY29wZS5mb3JtKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9zZWFyY2hcIik7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xufV0pO1xuIiwiXG4vL1RoaXMgc2hvdWxkIGdldCB0aGUgc2VhcmNoIGl0ZW1cbmFwcC5jb250cm9sbGVyKCdzZWFyY2hGdW5jdGlvbicsIFsnJHNjb3BlJywgJyRodHRwJywgJ1Jlc3VsdFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgUmVzdWx0U2VydmljZSkge1xuICAgICRzY29wZS5mb3JtSW5wdXQ9e307XG5cbiAgICAkc2NvcGUuc2VhcmNoQnRuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL3Bhc3NlcyBpbiBzZWFyY2ggdGV4dCB0byBzZXJ2aWNlXG4gICAgICAgUmVzdWx0U2VydmljZS5tYWtlRGF0YUNhbGwoJHNjb3BlLmZvcm1JbnB1dC5kYXRhKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3RoaXMgaXMgdGhlIGlucHV0IHRleHQnLCAkc2NvcGUuZm9ybUlucHV0KTtcbiAgICAgICAgLy9lbXB0eXMgdGhlIHNlYXJjaCBib3hcbiAgICAgICAgJHNjb3BlLmZvcm1JbnB1dD17fTtcbiAgICB9O1xuXG59XSk7XG4iLCIvL1RoaXMgc2VydmljZSBzaG91bGQgcGFzcyBkYXRhIGJldHdlZW4gY29udHJvbGxlcnNcbmFwcC5mYWN0b3J5KCdSZXN1bHRTZXJ2aWNlJywgWyckaHR0cCcsZnVuY3Rpb24oJGh0dHApIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHZhciBhZHVsdHMgPSBbXTtcbiAgICB2YXIgY29tcGFuaWVzID0gW107XG4gICAgdmFyIGtpZHMgPSBbXTtcblxuICAgIHZhciBtYWtlRGF0YUNhbGwgPSBmdW5jdGlvbihwYXNzZWREYXRhKSB7XG4gICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnLi4vc2VhcmNoJyxcbiAgICAgICAgICAgIHBhcmFtczp7c2VhcmNoOnBhc3NlZERhdGF9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXN1bHRzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIGdldENvbXBhbmllcyhyZXN1bHRzKTtcbiAgICAgICAgICAgIGdldEtpZHMocmVzdWx0cyk7XG4gICAgICAgICAgICBnZXRBZHVsdHMocmVzdWx0cyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldENvbXBhbmllcyA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgICAgIHZhciBnZXRFbGVtZW50MSA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgICAgICAgICBjb21wYW5pZXMuc3BsaWNlKDAsY29tcGFuaWVzLmxlbmd0aCk7XG4gICAgICAgICAgICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnR5cGUgPT0gJ2NvbXBhbnknKVxuICAgICAgICAgICAgICAgIGNvbXBhbmllcy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICBnZXRFbGVtZW50MShhcnJheSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0aGlzIGlzIGdldEVsZW1lbnQxJyxjb21wYW5pZXMpO1xuICAgICAgICByZXR1cm4gY29tcGFuaWVzXG4gICAgfTtcblxuICAgIHZhciBnZXRBZHVsdHMgPSBmdW5jdGlvbihhcnJheSkge1xuICAgICAgICB2YXIgZ2V0RWxlbWVudDIgPSBmdW5jdGlvbihhcnJheSkge1xuICAgICAgICAgICAgYWR1bHRzLnNwbGljZSgwLGFkdWx0cy5sZW5ndGgpO1xuICAgICAgICAgICAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC50eXBlID09ICdhZHVsdCcpXG4gICAgICAgICAgICAgICAgICAgIGFkdWx0cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgICAgZ2V0RWxlbWVudDIoYXJyYXkpO1xuICAgICAgICBjb25zb2xlLmxvZygndGhpcyBpcyBpbiBnZXRFbGVtZW50MicsIGFkdWx0cyk7XG4gICAgICAgIHJldHVybiBhZHVsdHNcbiAgICB9O1xuXG4gICAgdmFyIGdldEtpZHMgPSBmdW5jdGlvbihhcnJheSkge1xuICAgICAgICB2YXIgZ2V0RWxlbWVudDMgPSBmdW5jdGlvbihhcnJheSkge1xuICAgICAgICAgICAga2lkcy5zcGxpY2UoMCxraWRzLmxlbmd0aCk7XG4gICAgICAgICAgICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnR5cGUgPT0gJ2NoaWxkJylcbiAgICAgICAgICAgICAgICAgICAga2lkcy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgICAgZ2V0RWxlbWVudDMoYXJyYXkpO1xuICAgICAgICBjb25zb2xlLmxvZygndGhpcyBpcyBnZXRFbGVtZW50czMnLCBraWRzKTtcbiAgICAgICAgcmV0dXJuIGtpZHNcbiAgICB9O1xuXG4gICAgLy9wdWJsaWNcbiAgICB2YXIgcHVibGljQXBpID0ge1xuICAgICAgICBnZXRLaWRzOiBnZXRLaWRzLFxuICAgICAgICBnZXRBZHVsdHM6IGdldEFkdWx0cyxcbiAgICAgICAgZ2V0Q29tcGFuaWVzOiBnZXRDb21wYW5pZXMsXG4gICAgICAgIG1ha2VEYXRhQ2FsbDogbWFrZURhdGFDYWxsLFxuICAgICAgICByZXN1bHRzOiByZXN1bHRzLFxuICAgICAgICBjb21wYW5pZXM6IGNvbXBhbmllcyxcbiAgICAgICAgYWR1bHRzOiBhZHVsdHMsXG4gICAgICAgIGtpZHM6IGtpZHNcbiAgICB9O1xuICAgIHJldHVybiBwdWJsaWNBcGk7XG59XSk7IiwiLy8gUGxlYXNlIG5vdGUgdGhhdCAkbW9kYWxJbnN0YW5jZSByZXByZXNlbnRzIGEgbW9kYWwgd2luZG93IChpbnN0YW5jZSkgZGVwZW5kZW5jeS5cbi8vIEl0IGlzIG5vdCB0aGUgc2FtZSBhcyB0aGUgJHVpYk1vZGFsIHNlcnZpY2UgdXNlZCBhYm92ZS5cblxuLy9uZWVkZWQgZm9yIG1vZGFsPz8gcHJldHR5IHN1cmVcbmFwcC5jb250cm9sbGVyKCdNb2RhbEluc3RhbmNlQ3RybCcsWyckc2NvcGUnLCckbW9kYWxJbnN0YW5jZScsIGZ1bmN0aW9uICgkc2NvcGUsICRtb2RhbEluc3RhbmNlKSB7XG5cbiAgICAkc2NvcGUub2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5zZWxlY3RlZC5pdGVtKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgfTtcbn1dKTsiLCJhcHAuY29udHJvbGxlcignbmF2Q3RybCcsIFsnYXV0aFNlcnZpY2UnLCckc2NvcGUnLCckcm9vdFNjb3BlJywnJGxvY2F0aW9uJywgZnVuY3Rpb24oYXV0aFNlcnZpY2UsICRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uKXtcbiAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG5cbiAgICBpZigkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ob21lJyk7XG4gICAgfVxuXG4gICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGF1dGhTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiKTtcbiAgICB9XG59XSk7XG4iLCIvLyBBamF4IGZvciBjcmVhdGluZyB0aGUgY29udGFjdCBsaXN0IGluIGNvbnN0YW50IGNvbnRhY3RcbmFwcC5jb250cm9sbGVyKCduZXdDb250YWN0TGlzdENvbnRyb2xsZXInLFsnbmV3Q29udGFjdExpc3REYXRhJywnJHNjb3BlJywgZnVuY3Rpb24obmV3Q29udGFjdExpc3REYXRhLCAkc2NvcGUpIHtcbiAgICAvL2RhdGEgdG8gY3JlYXRlIGEgbmV3IGNvbnRhY3QgbGlzdFxuXG5cbiAgICAkc2NvcGUubGlzdG5hbWUgPSB7fTtcblxuICAgICRzY29wZS5jcmVhdGVMaXN0ICA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjcmVhdGUgbGlzdDogXCIgKyAkc2NvcGUubGlzdG5hbWUuaW5wdXQpO1xuICAgICAgICAvL3Bhc3NlcyBsaXN0IG5hbWUgc2VydmljZVxuICAgICAgICBuZXdDb250YWN0TGlzdERhdGEucG9zdExpc3QoJHNjb3BlLmxpc3RuYW1lLmlucHV0KTtcblxuICAgICAgICBjb25zb2xlLmxvZygnbGlzdCAjJyxuZXdDb250YWN0TGlzdERhdGEubGlzdE51bSk7XG5cbiAgICAgICAgJHNjb3BlLmxpc3RuYW1lPXt9O1xuICAgIH07XG59XSk7XG5cblxuIiwiYXBwLnNlcnZpY2UoJ25ld0NvbnRhY3RMaXN0RGF0YScsIFsnQ29udGFjdExpc3REYXRhU2VydmljZScsICckaHR0cCcsXG4gICAgZnVuY3Rpb24gKENvbnRhY3RMaXN0RGF0YVNlcnZpY2UsICRodHRwKSB7XG4gICAgICAgIHRoaXMubmV3Q29udGFjdExpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5saXN0TnVtID0gXCIwXCI7XG4gICAgICAgIHRoaXMucG9zdExpc3QgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJkaWQgdGhlIG5hbWUgbWFrZSBpdCB0byB0aGUgc2VydmljZT8gXCIgKyBuYW1lICk7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL25ld0NvbnRhY3RMaXN0Jywge25hbWU6IG5hbWV9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgIGxpc3ROdW0gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSWQ/IFwiLCBsaXN0TnVtKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpOyAvL2Vycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pbXBvcnREYXRhQXJyYXkgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJlbWFpbF9hZGRyZXNzZXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcInVzZXIxQGV4YW1wbGUuY29tXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwiZmlyc3RfbmFtZVwiOiBcIkpvaG5cIixcbiAgICAgICAgICAgICAgICBcImxhc3RfbmFtZVwiOiBcIlNtaXRoXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wYW55X25hbWVcIjogXCJDb21wYW55IFhcIixcbiAgICAgICAgICAgICAgICBcImFkZHJlc3Nlc1wiOiBbe1xuICAgICAgICAgICAgICAgICAgICBjaXR5OiBcImFueXRvd25cIlxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiZW1haWxfYWRkcmVzc2VzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJ1c2VyMkBleGFtcGxlLmNvbVwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImZpcnN0X25hbWVcIjogXCJKYW5lXCIsXG4gICAgICAgICAgICAgICAgXCJsYXN0X25hbWVcIjogXCJTbWl0aHlcIixcbiAgICAgICAgICAgICAgICBcImNvbXBhbnlfbmFtZVwiOiBcIkNvbXBhbnkgWVwiLFxuICAgICAgICAgICAgICAgIFwiYWRkcmVzc2VzXCI6IFt7XG4gICAgICAgICAgICAgICAgICAgIGNpdHk6IFwic29tZXRvd25cIlxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgICAgIHRoaXMucG9wTGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldENoZWNrZWQoKTtcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy9wb3B1bGF0ZUNvbnRhY3RMaXN0LmpzJywgaW1wb3J0RGF0YUFycmF5LCBsaXN0TnVtKS50aGVuKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhvcHRpb25zKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy9nZXQgYWxsIHRoZSBjaGVja2VkIGVsZW1lbnRzIGFuZCBzdHVmZiB0aGVtIGluIGFuIGFycmF5XG4gICAgICAgIHZhciBnZXRDaGVja2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJChcIjpjaGVja2VkLnR5cGUtZWxlbWVudFwiKS5lYWNoKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09IENvbnRhY3RMaXN0RGF0YVNlcnZpY2UucmVzdWx0cy5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRhY3RPYmplY3QgPVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxfYWRkcmVzc2VzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lbWFpbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmaXJzdF9uYW1lXCI6ICQodGhpcykuZmlyc3ROYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdF9uYW1lXCI6ICQodGhpcykubGFzdE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21wYW55X25hbWVcIjogJCh0aGlzKS5jb21wYW55LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWRkcmVzc2VzXCI6IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpdHk6ICQodGhpcykuY2l0eVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0RGF0YUFycmF5LnB1c2goY29udGFjdE9iamVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfV0pO1xuLy8gc2VydmljZSBmb3IgYWpheCBjYWxscyB0byBjb25zdGFudCBjb250YWN0XG4vL1xuLy9hcHAuc2VydmljZSgnbmV3Q29udGFjdExpc3REYXRhJywgWydDb250YWN0TGlzdERhdGFTZXJ2aWNlJywgJyRodHRwJyxcbi8vICAgIGZ1bmN0aW9uIChDb250YWN0TGlzdERhdGFTZXJ2aWNlLCAkaHR0cCkge1xuLy9cbi8vICAgIHZhciBuZXdDb250YWN0TGlzdCA9IFtdO1xuLy8gICAgdmFyIGxpc3ROdW0gPSBcIjE0OTk1MjM2MTBcIjtcbi8vXG4vLyAgICB0aGlzLnBvc3RMaXN0ID0gZnVuY3Rpb24gKCkge1xuLy8gICAgICAgICRodHRwLnBvc3QoJy9uZXdDb250YWN0TGlzdCcpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbi8vICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4vLyAgICAgICAgICAgIGxpc3ROdW0gPSBkYXRhLmlkXG4vL1xuLy8gICAgICAgIH0sIGZ1bmN0aW9uKGRhdGEpe1xuLy8gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTsgLy9lcnJvclxuLy8gICAgICAgIH0pO1xuLy8gICAgICAgIGNvbnNvbGUubG9nKG9wdGlvbnMpXG4vLyAgICB9O1xuLy9cbi8vICAgIHZhciBpbXBvcnREYXRhQXJyYXkgPSBbXG4vLyAgICAgICAge1xuLy8gICAgICAgICAgICBcImVtYWlsX2FkZHJlc3Nlc1wiOiBbXG4vLyAgICAgICAgICAgICAgICBcInVzZXIxQGV4YW1wbGUuY29tXCJcbi8vICAgICAgICAgICAgXSxcbi8vICAgICAgICAgICAgXCJmaXJzdF9uYW1lXCI6IFwiSm9oblwiLFxuLy8gICAgICAgICAgICBcImxhc3RfbmFtZVwiOiBcIlNtaXRoXCIsXG4vLyAgICAgICAgICAgIFwiY29tcGFueV9uYW1lXCI6IFwiQ29tcGFueSBYXCIsXG4vLyAgICAgICAgICAgIFwiYWRkcmVzc2VzXCI6IFt7XG4vLyAgICAgICAgICAgICAgICBjaXR5OiBcImFueXRvd25cIlxuLy8gICAgICAgICAgICB9XVxuLy8gICAgICAgIH0sXG4vLyAgICAgICAge1xuLy8gICAgICAgICAgICBcImVtYWlsX2FkZHJlc3Nlc1wiOiBbXG4vLyAgICAgICAgICAgICAgICBcInVzZXIyQGV4YW1wbGUuY29tXCJcbi8vICAgICAgICAgICAgXSxcbi8vICAgICAgICAgICAgXCJmaXJzdF9uYW1lXCI6IFwiSmFuZVwiLFxuLy8gICAgICAgICAgICBcImxhc3RfbmFtZVwiOiBcIlNtaXRoeVwiLFxuLy8gICAgICAgICAgICBcImNvbXBhbnlfbmFtZVwiOiBcIkNvbXBhbnkgWVwiLFxuLy8gICAgICAgICAgICBcImFkZHJlc3Nlc1wiOiBbe1xuLy8gICAgICAgICAgICAgICAgY2l0eTogXCJzb21ldG93blwiXG4vLyAgICAgICAgICAgIH1dXG4vLyAgICAgICAgfVxuLy8gICAgXTtcbi8vXG4vLyAgICAvL3ZhciBjb250YWN0TGlzdE9iamVjdCA9KHtcbi8vICAgIC8vICAgIFwiSW1wb3J0IERhdGFcIiA6IGltcG9ydERhdGFBcnJheSxcbi8vICAgIC8vICAgIFwibGlzdFwiOiBbbGlzdE51bV0sXG4vLyAgICAvLyAgICBcImNvbHVtbl9uYW1lc1wiOltcIkVNQUlMXCIsXCJGSVJTVCBOQU1FXCIsIFwiTEFTVCBOQU1FXCIsIFwiQ0lUWVwiLFwiQ09NUEFOWSBOQU1FXCJdfSk7XG4vL1xuLy9cbi8vICAgIHRoaXMucG9wTGlzdCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICBnZXRDaGVja2VkKCk7XG4vLyAgICAgICAgJGh0dHAucG9zdCgnL3BvcHVsYXRlQ29udGFjdExpc3QuanMnLCBpbXBvcnREYXRhQXJyYXksIGxpc3ROdW0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4vLyAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuLy8gICAgICAgIH0pO1xuLy8gICAgICAgIGNvbnNvbGUubG9nKG9wdGlvbnMpO1xuLy9cbi8vICAgIH07XG4vL1xuLy8gICAgLy9nZXQgYWxsIHRoZSBjaGVja2VkIGVsZW1lbnRzIGFuZCBzdHVmZiB0aGVtIGluIGFuIGFycmF5XG4vLyAgICB2YXIgZ2V0Q2hlY2tlZCA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICAgJChcIjpjaGVja2VkLnR5cGUtZWxlbWVudFwiKS5lYWNoKFxuLy8gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuLy8gICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSBDb250YWN0TGlzdERhdGFTZXJ2aWNlLnJlc3VsdHMuaWQpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRhY3RPYmplY3QgPVxuLy8gICAgICAgICAgICAgICAgICAgICAgICB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsX2FkZHJlc3Nlc1wiOiBbXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lbWFpbFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmlyc3RfbmFtZVwiOiAkKHRoaXMpLmZpcnN0TmFtZSxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdF9uYW1lXCI6ICQodGhpcykubGFzdE5hbWUsXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNvbXBhbnlfbmFtZVwiOiAkKHRoaXMpLmNvbXBhbnksXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFkZHJlc3Nlc1wiOiBbe1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpdHk6ICQodGhpcykuY2l0eVxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgfV1cbi8vICAgICAgICAgICAgICAgICAgICAgICAgfTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0RGF0YUFycmF5LnB1c2goY29udGFjdE9iamVjdCk7XG4vLyAgICAgICAgICAgICAgICAgICAgfVxuLy9cbi8vICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgKTtcbi8vICAgICAgICB9XG4vL31dKTsiLCJhcHAuY29udHJvbGxlcigncG9wTGlzdENvbnRyb2xsZXInLFsnbmV3Q29udGFjdExpc3REYXRhJywnJHNjb3BlJywnJGh0dHAnLCBmdW5jdGlvbihuZXdDb250YWN0TGlzdERhdGEsICRzY29wZSwgJGh0dHApIHtcbiAgICAvL2RhdGEgdG8gY3JlYXRlIGEgbmV3IGNvbnRhY3QgbGlzdFxuXG5cbiAgICAkc2NvcGUubGlzdE5hbWUgPSB7fTtcblxuICAgICRzY29wZS5wb3B1bGF0ZUxpc3QgID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNyZWF0ZSBsaXN0OiBcIiArIHNjb3BlLmxpc3ROYW1lLmlucHV0KTtcbiAgICAgICAgLy9wYXNzZXMgaW4gc2VhcmNoIHRleHQgdG8gc2VydmljZVxuICAgICAgICBuZXdDb250YWN0TGlzdERhdGEucG9wTGlzdCgpO1xuICAgICAgICAvL3ZhciBsaXN0RW5kID0ge1xuICAgICAgICAvLyAgICBcImxpc3RzXCI6IFtsaXN0TnVtXSxcbiAgICAgICAgLy8gICAgXCJjb2x1bW5fbmFtZXNcIjogW1xuICAgICAgICAvLyAgICBcIkVNQUlMXCIsXG4gICAgICAgIC8vICAgIFwiRklSU1QgTkFNRVwiLFxuICAgICAgICAvLyAgICBcIkxBU1QgTkFNRVwiLFxuICAgICAgICAvLyAgICBcIkNJVFlcIixcbiAgICAgICAgLy8gICAgXCJDT01QQU5ZIE5BTUVcIlxuICAgICAgICAvL119XG5cblxuICAgICAgICAkc2NvcGUubGlzdE5hbWU9e307XG4gICAgfTtcbn1dKTtcblxuIiwiXG4vL3JlZ2lzdGVyIGNvbnRyb2xsZXJcbmFwcC5jb250cm9sbGVyKCdyZWdpc3RlckN0cmwnLCBbICckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHtcbiAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlZ2lzdGVyQ3RybFwiKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlZ2lzdGVyQ29udHJvbGxlciBzdWJtaXQ6JywgJHNjb3BlLmZvcm0pO1xuICAgICAgICAkaHR0cC5wb3N0KCcvcmVnaXN0ZXInLCAkc2NvcGUuZm9ybSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9pbmRleFwiKVxuICAgICAgICAgICAgfSk7XG4gICAgfVxufV0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ3Jlc2V0Q3RybCcsIFsgJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikge1xuICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlZGl0IHBhc3N3b3JkOicsICRzY29wZS5mb3JtKTtcbiAgICAgICAgJGh0dHAucHV0KCcvYWRtaW4nLCAkc2NvcGUuZm9ybSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9pbmRleFwiKVxuICAgICAgICAgICAgfSk7XG4gICAgfVxufV0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
